{% extends "base.html" %}
{% block title %}Delivery Detail - SO #{{ so_number }}{% endblock %}
{% block content %}
<div class="container-fluid py-4 px-4">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb bg-transparent p-0">
            <li class="breadcrumb-item"><a href="{{ url_for('main.delivery_board') }}">Delivery Board</a></li>
            <li class="breadcrumb-item active">SO #{{ so_number }}</li>
        </ol>
    </nav>

    {% if header %}
    <!-- SO Header -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card card-ops">
                <div class="card-header">
                    <i class="fas fa-file-invoice mr-2"></i> Sales Order #{{ so_number }}
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="small text-muted text-uppercase font-weight-bold">Customer</div>
                                <div class="h5 font-weight-bold mb-0">{{ header.customer_name }}</div>
                            </div>
                            <div class="mb-3">
                                <div class="small text-muted text-uppercase font-weight-bold">Delivery Address</div>
                                <div>{{ header.address }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="small text-muted text-uppercase font-weight-bold">Reference / PO</div>
                                <div>{{ header.reference or 'N/A' }}</div>
                            </div>
                            <div class="mb-3">
                                <div class="small text-muted text-uppercase font-weight-bold">Delivery Status</div>
                                <span class="badge badge-pill badge-secondary p-2">Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card card-ops h-100">
                <div class="card-body text-center d-flex flex-column justify-content-center">
                    <div class="text-muted small text-uppercase font-weight-bold mb-2">Assigned Truck</div>
                    <div class="h3 text-muted mb-3">
                        <i class="fas fa-truck mr-2"></i> Not Yet Assigned
                    </div>
                    <div class="text-muted small">
                        Truck assignment and GPS tracking will appear here once the delivery is dispatched.
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle mr-2"></i> Could not load header data for SO #{{ so_number }}.
    </div>
    {% endif %}

    <!-- Line Items -->
    <div class="card card-ops">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span><i class="fas fa-boxes mr-2"></i> Line Items</span>
            <span class="badge badge-light">{{ items|length }} items</span>
        </div>
        <div class="card-body p-0">
            <table class="table table-ops mb-0">
                <thead>
                    <tr>
                        <th>Seq</th>
                        <th>Item #</th>
                        <th>Description</th>
                        <th>Handling Code</th>
                        <th>Qty</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td>{{ item.sequence }}</td>
                        <td class="font-weight-bold">{{ item.item_number }}</td>
                        <td>{{ item.description }}</td>
                        <td><span class="badge badge-pill badge-light">{{ item.handling_code }}</span></td>
                        <td>{{ item.qty }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            No line items found.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}
